# Movie Community

Justice Ladder Project

## 엄강우   최수병   조규성



## 개발환경

#### python 3.7+

#### Django 2.1.15



<hr>



# 엄강우

# 관리자 페이지

1. 기본적으로 스탶만이 이용할 수 있게끔 설계 되어 있습니다.
2. 유저 건의사항을 처리 할 수 있습니다.
3. 관리자 메인 페이지

   - 등록 되어 있는 모든 영화들을 나열하여서 볼 수 있다.
   - 등록된 영화 DATA를 수정 할 수 있다.
   - 등록된 영화 DATA를 삭제 할 수 있다.
4. 영화 등록 페이지

   1. 영화 검색

      - 영화 검색을 하면 일단 Naver API로 영화 관련 정보를 요청 해서 받아 옵니다.
      - 저희는 Tmdb도 함께 이용할 것 이기 때문에 네이버에서 받은 정보중 subtitle를 이용해 tmdb API에도 요청을 보냅니다.

   2. 영화 등록

      - 영화를 검색하면 왼쪽에는 TMdb API에서 가져온 data 오른쪽에는 naver api 에서 가져온 data를 나열 합니다.
      - Tmdb에서는 영화 고유 id와 장르를 이용할 것이고 naver api에서는 감독 배우 포스터 제목 등을 이용하였습니다.
      - 왼쪽과 오른쪽 결과물이 일치하는 것을 골라서 이미지를 클릭하면 체크박스에 체크가 됩니다.
      - 그리고 등록 버튼을 누르면 DB에 저장이 됩니다.

# 영화 추천 알고리즘

팔로우 기반 추천 알고리즘

- 유저가 팔로우 한 유저가 리뷰를 남긴 영화들중 상위 평점 6개 영화를 고른다.
- 고른 영화가 6개가 되지 않을 경우 전체 영화들중 상위 평점 영화들을 골라 6개를 채운다. 



# 최수병

### 추천 영화 알고리즘

main 페이지의 최신 등록 영화를 추천해주는 부분은 ``Movie``의 ``created_at`` 속성을 활용하여 내림차순으로 정렬하였습니다.

### 소셜로그인

로그인에 구글로그인은 ``allauth`` 라이브러리를 사용해서 구글아이디로 로그인 할 수 있도록 하였습니다. 다만 사이트를 사용하기 위해서는 ``User``에 ``nickname`` 속성이 필수라서 `nickname`의 default값을 `datetime.now()`로 설정하였습니다.  

### community

네비게이션바에 community를 클릭하면 ``Review``의 ``created_at ``속성을 활용하여 내림차순으로 정렬하였습니다.

### Movie Detail

한 줄 리뷰 작성하기를 클릭하면 한 줄 리뷰 작성 폼이 __Modal__에 나옵니다.

자신이 작성한 한 줄 리뷰는 수정, 삭제가 가능하며 수정을 누르면 수정 폼이 __Modal__으로 나옵니다.

해당 영화에 작성된 한 줄 리뷰를 ``pagination``으로 넘겨서 볼 수 있습니다.

상세리뷰 5개를 보여주고 모든 상세리뷰 보기 버튼을 통해서 해당 영화에 대한 모든 상세리뷰를 볼 수 있습니다.

### Article Detail

좋아요 기능을 구현하였습니다.

상세리뷰에 대하여 댓글을 작성할 수 있습니다.

자신이 작성한 댓글은 수정, 삭제가 가능하며 수정을 누르면 수정 폼이 __Modal__으로 나옵니다.



# 조규성

## UI

메인페이지, 전체 리뷰 게시판페이지, 영화 디테일페이지, 마이페이지, 검색 결과페이지, 네비게이션 바, 관리 중인 영화 목록페이지, 로그인페이지, 회원가입페이지, 프로필수정페이지의 UI를 제작했다. 상기 페이지는 bootstrap의 grid system을 적용하여 view port의 크기에 반응해 출력하는 요소자체 혹은 속성을 달리 하도록 제작되었다.



#### 게시글 리스트 테이블 사이즈문제

> community/.../all_of_article.html, article_list.html, movie_detail.html @block script

게시글 리스트에서는 포함하는 텍스트의 길이와 테이블의 크기를 최적화하기 위해 윈도우의 크기에 따라 text-cruncate 속성과 번호, 작성자, 작성일 칼럼을 포함시키거나 제거했다.



#### 페이지간 이동

최대한 많은 클릭 요소(게시글의 작성자, 게시글의 영화, 한 줄 리뷰 작성자, 마이페이지 팔로우의 글 좋아요 버튼, 영화 포스터)들을 집어 넣어 최대한 페이지끼리 연결 될 수 있도록했다.



#### 페이지 내 이동

Footer의 팝콘 아이콘을 클릭시 페이지의 최상단으로 스크롤이 올라가도록 했다.



#### 배지

게시판의 새로운 글, 좋아요를 많이 받은 글에는 New와 Hot 배지를 추가해 시각적으로 나타내었다. 한 줄 리뷰에서는 평점을 배지 안에 담고 평점에 따른 배지의 색을 달리해 영화에 대한 평가를 직관적으로 표현했다.



#### 영화 예고편

> community/.../movie_detail.html

movie_detail 페이지에서 구글의 youtube data API에 영화의 제목에 trailer를 추가해 검색결과를 요청했다. 그 결과중 첫번째 영상을 화면에 출력하기 위해 요소를 생성하고 링크를 설정해 추가했다.



---



## Code merge

마스터로의 모든 코드 통합을 관리했으며 그 과정에서의 충돌과 에러를 해결했다.



---



## Infinite Scroll

> accounts/.../detail.html @block script`  & `accounts/.../views.py @load_more

#bottomSensor div가 화면에 들어오면 ajax로 load_more에 다음 페이지(page_num)를 요구한다.

load_more에서는 followings 목록을 가져와 그들의 게시글을 정렬한 articles1을 생성한다. articles1을 페이지네이터를 이용해 원하는 페이지로 잘라 articles2를 생성한다. articles2의 각각의 객체에 접근하여 필요한 데이터를 dictionary 형식으로 articles에 추가한 뒤, articles를 json으로 변환해 axios 요청의 응답으로 보낸다.

Javascript에서 응답을 받으면 JSON을 articles에 변환해 저장해두고, 1초의 시간 딜레이를 준 후에 makeCard로 요소를 생성하고 좋아요 버튼이 활성화 될 수 있도록 EventListener를 설정해 #bottomSensor div 위에 추가했다. has_next 플래그를 만들고 갱신하며 has_next가 없다면 ajax 요청을 보내지 않는다.

MVVM 모델의 편리함과 위대함을 깨닫는 시간이었다.



---



## Accounts

#### 회원가입, 로그인, 정보수정, 마이페이지

마이페이지에서는 사용자가 한 줄 리뷰를 남긴 영화와, 팔로잉, 팔로워의 수, 팔로우한 유저의 게시글, 사용자의 닉네임, 간단한 소개글을 출력한다.



#### 프로필 이미지

User model의 photo에 Default를 지정해, 유저의 기본 프로필 이미지를 설정했다. 프로필 수정에서 유저가 프로필 이미지를 삭제한다면 None이 아니라 Default 값이 저장 되도록 처리했다. 업로드되는 이미지들이 한 폴더에 몰리지 않도록 `upload_to="profile/%Y/%m/%d"`속성을 주었다.



---



## Movie recommendation

#### 시간대별 장르

> main/views @intro

00시 - 04시 59분(호러)  / 05시 - 09시 59분(코미디) / 10시 - 13시 59분(스릴러) / 14시 - 17시 59분(액션) / 18시 - 20시 59분(로맨스) / 21시 - 21시 59분(드라마) / 22시 - 24시(다큐멘터리)

상기 기준으로 장르별 영화들을 가져와 movie_rate속성을 기준으로 정렬 후 출력했다.